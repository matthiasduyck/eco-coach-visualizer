<!DOCTYPE html>
<html lang="en" style="
    
">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battery SoH Visualization</title>
    <!-- Include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Include Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
<style type="text/css">
	.roboto-regular {
	  font-family: "Roboto", sans-serif;
	  font-weight: 400;
	  font-style: normal;
	}
	p,h1,h2{
		font-family: "Roboto", sans-serif;
	}

</style>
</head>
<body>
<h1>SOH tool</h1>
    <div id="soh_chart_div"></div>
    <div id="consumption_chart_div"></div>
    <script>
        $(document).ready(function() {
		console.log("Start getting data");
            // Fetch battery SoH data from API
            $.get('/getelectricdrivingdata', function(jsonData) {
			console.log("got data:");
			console.log(jsonData);
                // Use data to generate Google Charts visualization
                google.charts.load('current', {'packages':['corechart']});
				google.charts.setOnLoadCallback(drawCharts);

                function drawCharts() {
                	// Convert date strings to JavaScript Date objects
					jsonData.forEach(function(entry) {
						entry.date = new Date(entry.date);
					});

					function drawSOHchart() {
						var soh_data_table = new google.visualization.DataTable();
						soh_data_table.addColumn('date', 'Date');
						soh_data_table.addColumn('number', 'SoH');

						

						soh_data_table.addRows(
							jsonData
								.filter(entry => entry.soh >= 0)//we can have negative soh when driving downhill and regenerative braking
								.filter(entry => entry.distanceTraveled>3)//also filter out any short distances
								.map(entry => [entry.date, entry.soh]));

						var options = {
							title: 'Battery State of Health Over Time',
							curveType: 'function',
							legend: { position: 'bottom' },
							hAxis: {
								//format: 'yyyy-MM-dd_HH:mm' // Date format for horizontal axis labels
								
							},
							vAxis: {
								viewWindow: {
						            min: 0, // Minimum value on the x-axis
						            max: 150 // Maximum value on the x-axis
						        }
							}
						};


						var chart = new google.visualization.LineChart(document.getElementById('soh_chart_div'));

						chart.draw(soh_data_table, options);
					}
					drawSOHchart();

					function drawEfficiencyChart() {
						var efficiency_data_table = new google.visualization.DataTable();
						efficiency_data_table.addColumn('date', 'Date');
						efficiency_data_table.addColumn('number', 'Electric Consumption');

						

						efficiency_data_table.addRows(
							jsonData
								.filter(entry => entry.soh >= 0)//we can have negative soh when driving downhill and regenerative braking
								.filter(entry => entry.distanceTraveled>3)//also filter out any short distances
								.map(entry => [entry.date, entry.electricConsumption]));

						var options = {
							title: 'Electric Consumption Over Time',
							curveType: 'function',
							legend: { position: 'bottom' },
							hAxis: {
								//format: 'yyyy-MM-dd_HH:mm' // Date format for horizontal axis labels
								
							},
							vAxis: {
								viewWindow: {
						            min: 10, // Minimum value on the x-axis
						            max: 40 // Maximum value on the x-axis
						        }
							}
						};


						var chart = new google.visualization.LineChart(document.getElementById('consumption_chart_div'));

						chart.draw(efficiency_data_table, options);
					}
					drawEfficiencyChart();

					
				}
            });
        });
    </script>
</body>
</html>
